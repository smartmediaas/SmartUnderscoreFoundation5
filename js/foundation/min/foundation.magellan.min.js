!function(t,a){"use strict";Foundation.libs["magellan-expedition"]={name:"magellan-expedition",version:"5.1.0",settings:{active_class:"active",threshold:0,destination_threshold:20,throttle_delay:30},init:function(t,a,e){Foundation.inherit(this,"throttle"),this.bindings(a,e)},events:function(){var e=this,i=e.S,n=e.settings;e.set_expedition_position(),i(e.scope).off(".magellan").on("click.fndtn.magellan",'[data-magellan-arrival] a[href^="#"]',function(e){e.preventDefault();var i=t(this).closest("[data-magellan-expedition]"),n=(i.data("magellan-expedition-init"),this.hash.split("#").join("")),o=t("a[name="+n+"]");0===o.length&&(o=t("#"+n));var s=o.offset().top;"fixed"===i.css("position")&&(s-=i.outerHeight()),t("html, body").stop().animate({scrollTop:s},700,"swing",function(){a.location.hash="#"+n})}).on("scroll.fndtn.magellan",e.throttle(this.check_for_arrivals.bind(this),n.throttle_delay)).on("resize.fndtn.magellan",e.throttle(this.set_expedition_position.bind(this),n.throttle_delay))},check_for_arrivals:function(){var t=this;t.update_arrivals(),t.update_expedition_positions()},set_expedition_position:function(){var a=this;t("["+this.attr_name()+"=fixed]",a.scope).each(function(){var e,i=t(this),n=i.attr("styles");i.attr("style",""),e=i.offset().top,i.data(a.data_attr("magellan-top-offset"),e),i.attr("style",n)})},update_expedition_positions:function(){var e=this,i=t(a).scrollTop();t("["+this.attr_name()+"=fixed]",e.scope).each(function(){var a=t(this),e=a.data("magellan-top-offset");if(i>=e){var n=a.prev("[data-magellan-expedition-clone]");0===n.length&&(n=a.clone(),n.removeAttr("data-magellan-expedition"),n.attr("data-magellan-expedition-clone",""),a.before(n)),a.css({position:"fixed",top:0})}else a.prev("[data-magellan-expedition-clone]").remove(),a.attr("style","")})},update_arrivals:function(){var e=this,i=t(a).scrollTop();t("["+this.attr_name()+"]",e.scope).each(function(){var a=t(this),n=n=a.data(e.attr_name(!0)+"-init"),o=e.offsets(a,i),s=a.find("["+e.add_namespace("data-magellan-arrival")+"]"),l=!1;o.each(function(t,i){if(i.viewport_offset>=i.top_offset){var o=a.find("["+e.add_namespace("data-magellan-arrival")+"]");return o.not(i.arrival).removeClass(n.active_class),i.arrival.addClass(n.active_class),l=!0,!0}}),l||s.removeClass(n.active_class)})},offsets:function(a,e){var i=this,n=a.data(i.attr_name(!0)+"-init"),o=e+n.destination_threshold;return a.find("["+i.add_namespace("data-magellan-arrival")+"]").map(function(){var a=t(this).data(i.data_attr("magellan-arrival")),e=t("["+i.add_namespace("data-magellan-destination")+"="+a+"]");if(e.length>0){var n=e.offset().top;return{destination:e,arrival:t(this),top_offset:n,viewport_offset:o}}}).sort(function(t,a){return t.top_offset<a.top_offset?-1:t.top_offset>a.top_offset?1:0})},data_attr:function(t){return this.namespace.length>0?this.namespace+"-"+t:t},off:function(){this.S(this.scope).off(".magellan"),this.S(a).off(".magellan")},reflow:function(){var a=this;t("[data-magellan-expedition-clone]",a.scope).remove()}}}(jQuery,this,this.document);